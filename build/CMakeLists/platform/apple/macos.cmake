if (DEPLOYMENT_TARGET)
  if (NOT DEFINED DEPLOYMENT_TARGET_VERSION)
    set ( DEPLOYMENT_TARGET_VERSION  12)
  endif()
  set (CMAKE_OSX_DEPLOYMENT_TARGET ${DEPLOYMENT_TARGET_VERSION})
  message (STATUS "Deployment target is ${DEPLOYMENT_TARGET_VERSION}")
endif()
set (MACSDK /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk)
if ( NOT "${LLVM_PREFIX}" STREQUAL "" )
  set (CMAKE_SYSROOT ${LLVM_PREFIX})
endif()
if (EXISTS ${MACSDK})
  set (CMAKE_OSX_SYSROOT ${MACSDK})
  link_directories( ${MACSDK}/usr/lib )
  set (FAUST_LIBS -lpthread ${FAUST_LIBS})
else()
  message ("WARNING No SDK at ${MACSDK}")
endif()
if (UNIVERSAL)
  message (STATUS "Compiles an universal binary")
  set (CMAKE_OSX_ARCHITECTURES x86_64 arm64)
  set (FAUST_DEFINITIONS ${FAUST_DEFINITIONS} -DLLVM_BUILD_UNIVERSAL)
endif()
